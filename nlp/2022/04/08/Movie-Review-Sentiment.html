<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Predicting the Sentiment of Movie Reviews with NLP | DunGeon</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Predicting the Sentiment of Movie Reviews with NLP" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="By fine-tuning a language model on movie reviews, can we predict if they’re positive or negative?" />
<meta property="og:description" content="By fine-tuning a language model on movie reviews, can we predict if they’re positive or negative?" />
<link rel="canonical" href="https://geon-youn.github.io/DunGeon/nlp/2022/04/08/Movie-Review-Sentiment.html" />
<meta property="og:url" content="https://geon-youn.github.io/DunGeon/nlp/2022/04/08/Movie-Review-Sentiment.html" />
<meta property="og:site_name" content="DunGeon" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-08T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Predicting the Sentiment of Movie Reviews with NLP" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-08T00:00:00-05:00","datePublished":"2022-04-08T00:00:00-05:00","description":"By fine-tuning a language model on movie reviews, can we predict if they’re positive or negative?","headline":"Predicting the Sentiment of Movie Reviews with NLP","mainEntityOfPage":{"@type":"WebPage","@id":"https://geon-youn.github.io/DunGeon/nlp/2022/04/08/Movie-Review-Sentiment.html"},"url":"https://geon-youn.github.io/DunGeon/nlp/2022/04/08/Movie-Review-Sentiment.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/DunGeon/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://geon-youn.github.io/DunGeon/feed.xml" title="DunGeon" /><link rel="shortcut icon" type="image/x-icon" href="/DunGeon/images/icon.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/DunGeon/">DunGeon</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/DunGeon/about/">About Me</a><a class="page-link" href="/DunGeon/search/">Search</a><a class="page-link" href="/DunGeon/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Predicting the Sentiment of Movie Reviews with NLP</h1><p class="page-description">By fine-tuning a language model on movie reviews, can we predict if they're positive or negative?</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-04-08T00:00:00-05:00" itemprop="datePublished">
        Apr 8, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      12 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/DunGeon/categories/#nlp">nlp</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/geon-youn/DunGeon/tree/master/_notebooks/2022-04-08-Movie-Review-Sentiment.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/DunGeon/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/geon-youn/DunGeon/master?filepath=_notebooks%2F2022-04-08-Movie-Review-Sentiment.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/DunGeon/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/geon-youn/DunGeon/blob/master/_notebooks/2022-04-08-Movie-Review-Sentiment.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/DunGeon/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fgeon-youn%2FDunGeon%2Fblob%2Fmaster%2F_notebooks%2F2022-04-08-Movie-Review-Sentiment.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/DunGeon/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-04-08-Movie-Review-Sentiment.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Downloading-the-data-set">Downloading the data set<a class="anchor-link" href="#Downloading-the-data-set"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you didn't know, I work on Colab; I don't own a GPU that I can use to train models on my own. Whenever I download data sets, I end up having to redownload them when I come back on the next day. However, I found out how to download the data sets into my Google drive so that I don't have to redownload them every time. It's also helpful since I can save the pickles to the same folder instead of saving them on my laptop and having to upload them later.</p>
<p>It's really simple too: you mount onto your drive and then <code>cd</code> to your desired folder. When you download data sets, you download them into that folder. But, if you use <code>untar_data</code>, you have to move the files to the folder since it only saves to <code>~/.fastai/...</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mkdir -p <span class="s1">&#39;/content/gdrive/MyDrive/data_sets/&#39;</span>
<span class="o">%</span><span class="k">cd</span> &#39;/content/gdrive/MyDrive/data_sets/&#39;
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There's also a difference between <code>!</code> and <code>%</code> in Colab: <code>!</code> is like a "no side-effect" way to do command-line commands. <code>!mkdir ...</code> will make a directory, and <code>!cd ...</code> will change directories, except it doesn't, because that would be a side effect. So, to actually change the current directory that Colab is in, you have to use <code>%</code>. You can think of <code>%</code> as being able to change the variables stored in Colab; hypothetically <code>%cd path</code> makes Colab's <code>CURRENT_PATH = path</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.text.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">IMDB_SAMPLE</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mv <span class="o">{</span>str<span class="o">(</span>path<span class="o">)}</span> <span class="s1">&#39;/content/gdrive/MyDrive/data_sets/imdb_sample&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/content/gdrive/MyDrive/data_sets/imdb_sample&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preparing-the-data-for-the-language-model">Preparing the data for the language model<a class="anchor-link" href="#Preparing-the-data-for-the-language-model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since we're using the sample IMDB data set, we don't have separate folders, but instead have a single <code>.csv</code> file with 1000 reviews. So, we'll be using <code>TextBlock.from_df</code> instead of <code>TextBlock.from_text_files</code> to tell fastai how to get our data:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;texts.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span> <span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

  <div id="df-c39adc4b-06ec-4d83-85ce-57e366d49be9">
    <div class="colab-df-container">
      <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>text</th>
      <th>is_valid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>negative</td>
      <td>Un-bleeping-believable! Meg Ryan doesn't even look her usual pert lovable self in this, which normally makes me forgive her shallow ticky acting schtick. Hard to believe she was the producer on this dog. Plus Kevin Kline: what kind of suicide trip has his career been on? Whoosh... Banzai!!! Finally this was directed by the guy who did Big Chill? Must be a replay of Jonestown - hollywood style. Wooofff!</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>positive</td>
      <td>This is a extremely well-made film. The acting, script and camera-work are all first-rate. The music is good, too, though it is mostly early in the film, when things are still relatively cheery. There are no really superstars in the cast, though several faces will be familiar. The entire cast does an excellent job with the script.&lt;br /&gt;&lt;br /&gt;But it is hard to watch, because there is no good end to a situation like the one presented. It is now fashionable to blame the British for setting Hindus and Muslims against each other, and then cruelly separating them into two countries. There is som...</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>negative</td>
      <td>Every once in a long while a movie will come along that will be so awful that I feel compelled to warn people. If I labor all my days and I can save but one soul from watching this movie, how great will be my joy.&lt;br /&gt;&lt;br /&gt;Where to begin my discussion of pain. For starters, there was a musical montage every five minutes. There was no character development. Every character was a stereotype. We had swearing guy, fat guy who eats donuts, goofy foreign guy, etc. The script felt as if it were being written as the movie was being shot. The production value was so incredibly low that it felt li...</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c39adc4b-06ec-4d83-85ce-57e366d49be9')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  &lt;svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px"&gt;
    <path d="M0 0h24v24H0V0z" fill="none" />
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z" /><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z" />
  &lt;/svg&gt;
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c39adc4b-06ec-4d83-85ce-57e366d49be9 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c39adc4b-06ec-4d83-85ce-57e366d49be9');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>

</div>

</div>
</div>
</p>
    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls_lm</span> <span class="o">=</span> 
    <span class="n">DataBlock</span><span class="p">(</span>
        <span class="n">blocks</span>    <span class="o">=</span> <span class="n">TextBlock</span><span class="o">.</span><span class="n">from_df</span><span class="p">([</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">is_lm</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">get_items</span> <span class="o">=</span> <span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">),</span>
        <span class="n">splitter</span>  <span class="o">=</span> <span class="n">RandomSplitter</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When we show a batch, you can see how the independent variable contains one more token before the dependent variable, but has one less token at the end. Fastai also has special tokens that it makes through <code>TextBlock</code> (which uses the <code>Tokenizer</code> class):</p>
<ul>
<li><code>xxbos</code>: beginning of stream.</li>
<li><code>xxeos</code>: end of stream.</li>
<li><code>xxmaj</code>: next token is capitalized.</li>
<li><code>xxunk</code>: unknown (we ignore tokens that don't appear enough to minimize the size of the embedding matrix).</li>
<li><code>xxup</code>: next token is all uppercase.</li>
<li><code>xxrep</code> followed by a number <code>n</code>: the next actual token repeats <code>n</code> times.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls_lm</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>text_</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>xxbos xxmaj even though the book was n't strictly accurate to the real situation it described it still carried a sense of xxmaj japan . i find it hard to believe that anyone who was involved in making this film had ever been to japan as it did n't feel xxmaj japanese in the slightest . xxmaj almost everything about it was terrible . i will admit the actors were generally quite</td>
      <td>xxmaj even though the book was n't strictly accurate to the real situation it described it still carried a sense of xxmaj japan . i find it hard to believe that anyone who was involved in making this film had ever been to japan as it did n't feel xxmaj japanese in the slightest . xxmaj almost everything about it was terrible . i will admit the actors were generally quite good</td>
    </tr>
    <tr>
      <th>1</th>
      <td>; " the xxmaj return " ( xxunk xxmaj xxunk , 2003 ) ; " little xxmaj xxunk " ( james xxmaj xxunk ) ; xxmaj xxunk , " xxunk and xxmaj sons " ; and , of course , xxmaj xxunk , " the xxmaj brothers xxmaj xxunk . " \n\n xxmaj credits in xxmaj english indicate intended international xxunk , meaning that the excuse can not be used that you</td>
      <td>" the xxmaj return " ( xxunk xxmaj xxunk , 2003 ) ; " little xxmaj xxunk " ( james xxmaj xxunk ) ; xxmaj xxunk , " xxunk and xxmaj sons " ; and , of course , xxmaj xxunk , " the xxmaj brothers xxmaj xxunk . " \n\n xxmaj credits in xxmaj english indicate intended international xxunk , meaning that the excuse can not be used that you have</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>
</p>
    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In general, <code>Tokenizer</code> does a lot of extra things on top of tokenizing the texts:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">defaults</span><span class="o">.</span><span class="n">text_proc_rules</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;function fastai.text.core.fix_html&gt;,
 &lt;function fastai.text.core.replace_rep&gt;,
 &lt;function fastai.text.core.replace_wrep&gt;,
 &lt;function fastai.text.core.spec_add_spaces&gt;,
 &lt;function fastai.text.core.rm_useless_spaces&gt;,
 &lt;function fastai.text.core.replace_all_caps&gt;,
 &lt;function fastai.text.core.replace_maj&gt;,
 &lt;function fastai.text.core.lowercase&gt;]</pre>
</div>

</div>

</div>
</div>
</p>
    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Where</p>
<ul>
<li><code>fix_html</code>: replace special HTML characters with a readable version.</li>
<li><code>replace_rep</code>: replace characters repeated three or more times with <code>xxrep n c</code> where <code>xxrep</code> is the special token, <code>n</code> is the number of times it repeats, and <code>c</code> is the character.</li>
<li><code>replace_wrep</code>: replace words repeated three or more times with <code>xxwrep n w</code> where <code>w</code> is the word.</li>
<li><code>spec_add_spaces</code>: add spaces around special characters like <code>/</code> and <code>#</code> so they get split into separate tokens.</li>
<li><code>rm_useless_spaces</code>: remove repeated spaces.</li>
<li><code>replace_all_caps</code>: lowercase a word in all caps and add a <code>xxup</code> before it.</li>
<li><code>replace_maj</code>: lowercase a capitalized word and add a <code>xxmaj</code> before it.</li>
<li><code>lowercase</code>: lowercase all words and add a <code>xxbox</code> to the beginning and/or <code>xxeos</code> to the end of the string.</li>
</ul>
<p>And here's most of it in action:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tok</span> <span class="o">=</span> <span class="n">WordTokenizer</span><span class="p">()</span>
<span class="n">tkn</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">tkn</span><span class="p">(</span><span class="s1">&#39;amp; &amp;copy;   #a&quot; &lt;br /&gt;  www.google.ca/INDEX.html wow wow wow&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;xxbos&#39;,
 &#39;&amp;&#39;,
 &#39;©&#39;,
 &#39;#&#39;,
 &#39;a&#39;,
 &#39;&#34;&#39;,
 &#39;\n &#39;,
 &#39;xxrep&#39;,
 &#39;3&#39;,
 &#39;w&#39;,
 &#39;.google.ca&#39;,
 &#39;/&#39;,
 &#39;index.html&#39;,
 &#39;xxwrep&#39;,
 &#39;3&#39;,
 &#39;wow&#39;]</pre>
</div>

</div>

</div>
</div>
</p>
    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fine-tuning-the-language-model">Fine-tuning the language model<a class="anchor-link" href="#Fine-tuning-the-language-model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll be fine-tuning a language model pretrained on Wikepedia pages. This model uses a recurrent neural network using the AWD-LSTM architecture.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">language_model_learner</span><span class="p">(</span><span class="n">dls_lm</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">,</span> <span class="n">drop_mult</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">Perplexity</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since <code>pretrained</code> is set to <code>True</code> for our <code>language_model_learner</code> by default, all the layers except the head are frozen. So, we'll first train the head of the model for one epoch:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span><span class="o">.</span><span class="n">valley</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.127933</td>
      <td>3.944165</td>
      <td>0.272763</td>
      <td>51.633183</td>
      <td>00:57</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then, we'll unfreeze all the layers and train all the layers for another epoch:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span><span class="o">.</span><span class="n">valley</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">unfreeze</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>3.904036</td>
      <td>3.806237</td>
      <td>0.281909</td>
      <td>44.980846</td>
      <td>01:04</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll save the model as an <strong>encoder</strong>, which is the <em>body</em> of the model (the model not including the task-specific final layer(s)):</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">save_encoder</span><span class="p">(</span><span class="s1">&#39;lm&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we were to stop here, we'd have a text generator (which is what a language model is). We provide a piece of text and how many words we want it to predict:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;I liked the book better&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#34;i liked the book better , i had more movie time , so i was surprised , but i do n&#39;t like it . While i essentially liked this&#34;</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fine-tuning-the-language-model-for-a-classifier">Fine-tuning the language model for a classifier<a class="anchor-link" href="#Fine-tuning-the-language-model-for-a-classifier"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unlike language models, which are self-supervised, we have to provide our <code>DataLoaders</code> for our classifier with the labels:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls_c</span> <span class="o">=</span> 
    <span class="n">DataBlock</span><span class="p">(</span>
        <span class="n">blocks</span>   <span class="o">=</span> <span class="p">(</span><span class="n">TextBlock</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">dls_lm</span><span class="o">.</span><span class="n">vocab</span><span class="p">),</span> <span class="n">CategoryBlock</span><span class="p">),</span>
        <span class="n">get_x</span>    <span class="o">=</span> <span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">),</span>
        <span class="n">get_y</span>    <span class="o">=</span> <span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">),</span>
        <span class="n">splitter</span> <span class="o">=</span> <span class="n">ColSplitter</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This time, we have to specify our <code>blocks</code> differently so that our independent variable is a <code>TextBlock</code> and our dependent variable is a <code>CategoryBlock</code>. So, when show a part of a batch, it'll look different from a language model's <code>DataLoaders</code>:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls_c</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">max_n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>xxbos xxmaj raising xxmaj victor xxmaj vargas : a xxmaj review \n\n xxmaj you know , xxmaj raising xxmaj victor xxmaj vargas is like sticking your hands into a big , xxunk bowl of xxunk . xxmaj it 's warm and xxunk , but you 're not sure if it feels right . xxmaj try as i might , no matter how warm and xxunk xxmaj raising xxmaj victor xxmaj vargas became i was always aware that something did n't quite feel right . xxmaj victor xxmaj vargas suffers from a certain xxunk on the director 's part . xxmaj apparently , the director thought that the ethnic backdrop of a xxmaj latino family on the lower east side , and an xxunk storyline would make the film critic proof . xxmaj he was right , but it did n't fool me . xxmaj raising xxmaj victor xxmaj vargas is</td>
      <td>negative</td>
    </tr>
    <tr>
      <th>1</th>
      <td>xxbos xxup the xxup shop xxup around xxup the xxup corner is one of the xxunk and most feel - good romantic comedies ever made . xxmaj there 's just no getting around that , and it 's hard to actually put one 's feeling for this film into words . xxmaj it 's not one of those films that tries too hard , nor does it come up with the xxunk possible scenarios to get the two protagonists together in the end . xxmaj in fact , all its charm is xxunk , contained within the characters and the setting and the plot … which is highly believable to xxunk . xxmaj it 's easy to think that such a love story , as beautiful as any other ever told , * could * happen to you … a feeling you do n't often get from other romantic comedies</td>
      <td>positive</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we'll define a <code>Learner</code> by using the <code>text_classifier_learner</code> class:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">text_classifier_learner</span><span class="p">(</span><span class="n">dls_c</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">,</span> <span class="n">drop_mult</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And load the encoder:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">load_encoder</span><span class="p">(</span><span class="s1">&#39;lm&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When fine-tuning a language model for a text classifier, it's recommended to use discriminative learning rates and gradual unfreezing. So, we'll first fine-tune it for 1 epoch:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2e-2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.587637</td>
      <td>0.625740</td>
      <td>0.655000</td>
      <td>00:16</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then unfreeze the last 2 layers and begin using discriminative learning rates:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">den</span> <span class="o">=</span> <span class="mf">2.6</span><span class="o">**</span><span class="mi">4</span>
<span class="n">learn</span><span class="o">.</span><span class="n">freeze_to</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="mf">1e-2</span><span class="o">/</span><span class="n">den</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.445948</td>
      <td>0.522101</td>
      <td>0.715000</td>
      <td>00:19</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then unfreeze up to the last 3 layers:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">freeze_to</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="mf">5e-3</span><span class="o">/</span><span class="n">den</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.306446</td>
      <td>0.478002</td>
      <td>0.780000</td>
      <td>00:28</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next unfreeze the entire model:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">unfreeze</span><span class="p">()</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="mf">1e-3</span><span class="o">/</span><span class="n">den</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.208012</td>
      <td>0.417342</td>
      <td>0.795000</td>
      <td>00:36</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.193315</td>
      <td>0.410684</td>
      <td>0.805000</td>
      <td>00:36</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And finally train for a few more epochs:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.162276</td>
      <td>0.398424</td>
      <td>0.820000</td>
      <td>00:36</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.146796</td>
      <td>0.461882</td>
      <td>0.790000</td>
      <td>00:36</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.114655</td>
      <td>0.511482</td>
      <td>0.835000</td>
      <td>00:36</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.092193</td>
      <td>0.437872</td>
      <td>0.825000</td>
      <td>00:35</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.074616</td>
      <td>0.423975</td>
      <td>0.835000</td>
      <td>00:36</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And we're done! We can try predicting the sentiment of a few <em>Morbius</em> reviews:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span>
<span class="s2">&quot;So many choices... just seem halfhearted. They&#39;re not terrible, but they&#39;re also not interesting.&quot;</span><span class="p">,</span>
<span class="s2">&quot;Doesn&#39;t deliver a lot of high notes, but it&#39;s not unwatchable (especially if you enjoy the vampire genre). </span><span class="se">\&quot;</span><span class="s2">Morbius</span><span class="se">\&quot;</span><span class="s2"> is not as great as you&#39;d hoped, but not as bad as you feared.&quot;</span><span class="p">,</span>
<span class="s2">&quot;Overall, this is an entertaining movie. It sucks you in with the action and standout scenes between some of the characters. But, while Morbius has the makings of a great anti-hero revival, it wavers with the execution.&quot;</span><span class="p">,</span>
<span class="s2">&quot;Like the Venom films and unlike the MCU movies Morbius eschews the mythmaking of the Avengers for darkly comic horror.&quot;</span><span class="p">,</span>
<span class="s2">&quot;Sadly, director Daniel Espinosa&#39;s action horror is itself drained of atmosphere, shocks and drama.&quot;</span>
<span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;negative&#39;, TensorText(0), TensorText([0.9590, 0.0410])),
 (&#39;negative&#39;, TensorText(0), TensorText([0.8723, 0.1277])),
 (&#39;positive&#39;, TensorText(1), TensorText([0.0055, 0.9945])),
 (&#39;positive&#39;, TensorText(1), TensorText([0.0279, 0.9721])),
 (&#39;negative&#39;, TensorText(0), TensorText([0.5976, 0.4024]))]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this blog, I applied the ULMFiT approach to NLP. I fine-tuned the pretrained language model that was trained on Wikepedia pages with the smaller version of the IMDB data set to create a language model that can generate text relevant to movie reviews. Then, I used the encoder from that model to train a movie review sentiment classifier with an accuracy of 83.5%. For a model that was only trained with 1000 reviews, it's not that bad!</p>
<p>For next steps, I'd like to train a model using the full IMDB data set, but I don't have the necessary hardware to do it in a reasonable time. When I tried training a <code>Learner</code> on the full data set, the estimated time for the first epoch was two and a half hours. Maybe in the future when I pay for a GPU server or own my own setup.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="geon-youn/DunGeon"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/DunGeon/nlp/2022/04/08/Movie-Review-Sentiment.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/DunGeon/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/DunGeon/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/DunGeon/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>The DunGeon holding ipynbs</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/geon-youn" target="_blank" title="geon-youn"><svg class="svg-icon grey"><use xlink:href="/DunGeon/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/griolu" target="_blank" title="griolu"><svg class="svg-icon grey"><use xlink:href="/DunGeon/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
