<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Adding deep learning to tabular models | DunGeon</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Adding deep learning to tabular models" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ensembling just got a whole lot more interesting." />
<meta property="og:description" content="Ensembling just got a whole lot more interesting." />
<link rel="canonical" href="https://geon-youn.github.io/DunGeon/tabular/2022/03/31/Blue-Book-NN.html" />
<meta property="og:url" content="https://geon-youn.github.io/DunGeon/tabular/2022/03/31/Blue-Book-NN.html" />
<meta property="og:site_name" content="DunGeon" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-31T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Adding deep learning to tabular models" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-31T00:00:00-05:00","datePublished":"2022-03-31T00:00:00-05:00","description":"Ensembling just got a whole lot more interesting.","headline":"Adding deep learning to tabular models","mainEntityOfPage":{"@type":"WebPage","@id":"https://geon-youn.github.io/DunGeon/tabular/2022/03/31/Blue-Book-NN.html"},"url":"https://geon-youn.github.io/DunGeon/tabular/2022/03/31/Blue-Book-NN.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/DunGeon/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://geon-youn.github.io/DunGeon/feed.xml" title="DunGeon" /><link rel="shortcut icon" type="image/x-icon" href="/DunGeon/images/icon.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/DunGeon/">DunGeon</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/DunGeon/about/">About Me</a><a class="page-link" href="/DunGeon/search/">Search</a><a class="page-link" href="/DunGeon/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Adding deep learning to tabular models</h1><p class="page-description">Ensembling just got a whole lot more interesting.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-03-31T00:00:00-05:00" itemprop="datePublished">
        Mar 31, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/DunGeon/categories/#tabular">tabular</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/geon-youn/DunGeon/tree/master/_notebooks/2022-03-31-Blue-Book-NN.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/DunGeon/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/geon-youn/DunGeon/master?filepath=_notebooks%2F2022-03-31-Blue-Book-NN.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/DunGeon/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/geon-youn/DunGeon/blob/master/_notebooks/2022-03-31-Blue-Book-NN.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/DunGeon/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fgeon-youn%2FDunGeon%2Fblob%2Fmaster%2F_notebooks%2F2022-03-31-Blue-Book-NN.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/DunGeon/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-03-31-Blue-Book-NN.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Two blogs on the same day! I didn't want the last one to be too long and I didn't think I would be this productive to be able to finish the neural network part today. But, here we go.</p>
<hr />
<p>Previously, I trained a random forest model for predicting sale price on past auction data for bulldozers. Today, I'm going to be training a deep learning model on the same data set (with some changes based on the <a href="https://geon-youn.github.io/DunGeon/2022/03/31/Blue-Book.html">last blog</a>). Then, I'll try using the embeddings learned from that model and train another random forest model and aim for an even better validation RMSE. Finally, I'll ensemble the results of the deep learning model and the new random forest model and see how much better the predictions become.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, we'll first read our data into a pandas <code>DataFrame</code>,</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;TrainAndValid.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then, we apply the initial transforms we did last time:</p>
<ul>
<li>Set an order for the product sizes.</li>
<li>Log the sale price.</li>
<li>Split the date column into metacolumns.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sizes</span> <span class="o">=</span> <span class="s1">&#39;Large&#39;</span><span class="p">,</span><span class="s1">&#39;Large / Medium&#39;</span><span class="p">,</span><span class="s1">&#39;Medium&#39;</span><span class="p">,</span><span class="s1">&#39;Small&#39;</span><span class="p">,</span><span class="s1">&#39;Mini&#39;</span><span class="p">,</span><span class="s1">&#39;Compact&#39;</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ProductSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ProductSize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ProductSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ProductSize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">set_categories</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">add_datepart</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;saledate&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And we remove all the unneeded columns we determined last time:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_keep_df</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s1">&#39;xs_new.pkl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to_keep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_keep_df</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">to_keep</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

  <div id="df-50962503-1098-4e3d-b16f-3a3c3598705d">
    <div class="colab-df-container">
      <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YearMade</th>
      <th>ProductSize</th>
      <th>Coupler_System</th>
      <th>fiProductClassDesc</th>
      <th>...</th>
      <th>Drive_System</th>
      <th>Hydraulics</th>
      <th>Tire_Size</th>
      <th>SalePrice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2004</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Wheel Loader - 110.0 to 120.0 Horsepower</td>
      <td>...</td>
      <td>NaN</td>
      <td>2 Valve</td>
      <td>None or Unspecified</td>
      <td>11.097410</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1996</td>
      <td>Medium</td>
      <td>NaN</td>
      <td>Wheel Loader - 150.0 to 175.0 Horsepower</td>
      <td>...</td>
      <td>NaN</td>
      <td>2 Valve</td>
      <td>23.5</td>
      <td>10.950807</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2001</td>
      <td>NaN</td>
      <td>None or Unspecified</td>
      <td>Skid Steer Loader - 1351.0 to 1601.0 Lb Operating Capacity</td>
      <td>...</td>
      <td>NaN</td>
      <td>Auxiliary</td>
      <td>NaN</td>
      <td>9.210340</td>
    </tr>
  </tbody>
</table>
<p>3 rows Ã— 15 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-50962503-1098-4e3d-b16f-3a3c3598705d')" title="Convert this dataframe to an interactive table." style="display:none;">
        
  &lt;svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px"&gt;
    <path d="M0 0h24v24H0V0z" fill="none" />
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z" /><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z" />
  &lt;/svg&gt;
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-50962503-1098-4e3d-b16f-3a3c3598705d button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-50962503-1098-4e3d-b16f-3a3c3598705d');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we have to know which columns should be treated as categorical so that they can be given embeddings. For that, we'll use <code>cont_cat_split</code>, but we set the max cardinality as 9000 (embedding sizes greater than 10,000 should be used after you tested if there's better ways to group the variable).</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cont</span><span class="p">,</span> <span class="n">cat</span> <span class="o">=</span> <span class="n">cont_cat_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">max_card</span><span class="o">=</span><span class="mi">9_000</span><span class="p">,</span> <span class="n">dep_var</span><span class="o">=</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Mainly, we want to ensure <code>saleElapsed</code> is in the continuous section since by definition, if a label is in the categorical section, it cannot be extrapolated.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cont</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;saleElapsed&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, let's see the cardinality of each of the categorical variables (if there's some that are similar in number, they may be redundant and we can try to remove all but one):</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>YearMade                73
ProductSize              6
Coupler_System           2
fiProductClassDesc      74
ModelID               5281
fiSecondaryDesc        177
Enclosure                6
fiModelDesc           5059
ProductGroupDesc         6
fiModelDescriptor      140
Drive_System             4
Hydraulics              12
Tire_Size               17
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It appears that <code>ModelID</code> and <code>fiModelDesc</code> may be redundant since they're both pertaining to <code>Model</code> and are of similar cardinality. So, we'll do what we did before and try removing <code>fiModelDesc</code> and see what happens to the results.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_oob</span><span class="p">(</span><span class="n">xs_new</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.8760441852100622</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">get_oob</span><span class="p">(</span><span class="n">xs_new</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> 
 <span class="p">[</span><span class="s1">&#39;ModelID&#39;</span><span class="p">,</span> <span class="s1">&#39;fiModelDesc&#39;</span><span class="p">,</span> <span class="s1">&#39;fiModelDescriptor&#39;</span><span class="p">]}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ModelID&#39;: 0.8717292042012881,
 &#39;fiModelDesc&#39;: 0.869256405033346,
 &#39;fiModelDescriptor&#39;: 0.8748457618690582}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Overall, it seems we can remove <code>fiModelDescriptor</code> without it significantly affecting the model.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cat</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;fiModelDescriptor&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To create <code>DataLoaders</code> for our model, we can use <code>TabularPandas</code> again. However, we have to add the <code>Normalize</code> <code>TabularProc</code> for a neural network since the scale of the variables matter unlike in building a decision tree.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tp</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">],</span>
                   <span class="n">cat</span><span class="p">,</span> <span class="n">cont</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span> <span class="n">y_names</span><span class="o">=</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># a vision model since we&#39;re dealing with</span>
<span class="c1"># dabular data (doesn&#39;t require as much GPU RAM)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we'll see what range we should have for our predictions.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y</span><span class="p">,</span> <span class="n">v_y</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tp</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">y</span>
<span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">v_y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">v_y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(8.465899467468262, 11.863582611083984, 8.465899467468262, 11.849397659301758)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, we can set our <code>y_range</code> as (8, 12) (remember that a model tends to do better when we have our upper bound a little higher than the actual maximum).</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">tabular_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span> 
                        <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">n_out</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">loss_func</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As always, we'll use <code>.lr_find()</code> to find the optimal learning rate:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span><span class="o">.</span><span class="n">valley</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And, we'll use <code>fit_one_cycle</code> to train our model since we're not transfer learning:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">lr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.068500</td>
      <td>0.075998</td>
      <td>00:07</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.052604</td>
      <td>0.063197</td>
      <td>00:07</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.047209</td>
      <td>0.059763</td>
      <td>00:07</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.043221</td>
      <td>0.061487</td>
      <td>00:07</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.039401</td>
      <td>0.053084</td>
      <td>00:07</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span><span class="p">,</span> <span class="n">targs</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">get_preds</span><span class="p">()</span>
<span class="n">r_mse</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.230399</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Overall, we got a better RMSE than the random forest model, but not by a lot.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we'll try using the embeddings from the neural network to replace the categorical columns for our random forest:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># code is essentially verbatim from fast.ai&#39;s @danielwbn:</span>
<span class="c1"># https://forums.fast.ai/t/using-embedding-from-the-neural-network-in-random-forests/80063/10</span>
<span class="k">def</span> <span class="nf">transfer_embeds</span><span class="p">(</span><span class="n">learn</span><span class="p">,</span> <span class="n">xs</span><span class="p">):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">cat_names</span><span class="p">):</span>
        <span class="n">emb</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span> 
        <span class="c1"># added .cpu() to learn since tensor below is made on cpu while learn is on cuda</span>
        <span class="n">new_feat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">emb</span><span class="p">(</span><span class="n">tensor</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)),</span>
                                <span class="n">index</span><span class="o">=</span><span class="n">xs</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">emb</span><span class="o">.</span><span class="n">embedding_dim</span><span class="p">)])</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_feat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xs_with_embs</span>       <span class="o">=</span> <span class="n">transfer_embeds</span><span class="p">(</span><span class="n">learn</span><span class="p">,</span> <span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">xs</span><span class="p">)</span> 
<span class="n">valid_xs_with_embs</span> <span class="o">=</span> <span class="n">transfer_embeds</span><span class="p">(</span><span class="n">learn</span><span class="p">,</span> <span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">xs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">rf</span><span class="p">(</span><span class="n">xs_with_embs</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">m_rmse</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">xs_with_embs</span><span class="p">,</span> <span class="n">train_y</span><span class="p">),</span> <span class="n">m_rmse</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">valid_xs_with_embs</span><span class="p">,</span> <span class="n">valid_y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(0.184022, 0.236021)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The validation RMSE ends up becoming worse! But, take a look at this:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll look at our RMSE when we ensemble the predictions from random forests (with embeddings) and the neural network. However, before we can take the average of the predictions from random forests and the neural network, we have to make them of the same type. To do so, we have to turn our neural network predictions (a rank-2 tensor) into a rank-1 numpy array. We can apply <code>.squeeze()</code> to remove any unit axis (a vector with only 1 thing in it)</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rf_preds</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">valid_xs_with_embs</span><span class="p">)</span>
<span class="n">ens_preds</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_np</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span> <span class="o">+</span> <span class="n">rf_preds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">r_mse</span><span class="p">(</span><span class="n">ens_preds</span><span class="p">,</span> <span class="n">valid_y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.228773</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And, we now have an RMSE that's lower than the top leaderboard score of 0.22909, granted we're doing it on the validation set (since we don't have access to the <code>SalePrice</code> of <code>Test.csv</code>):</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Test.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;SalePrice&#39;</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(Index([&#39;SalesID&#39;, &#39;MachineID&#39;, &#39;ModelID&#39;, &#39;datasource&#39;, &#39;auctioneerID&#39;,
        &#39;YearMade&#39;, &#39;MachineHoursCurrentMeter&#39;, &#39;UsageBand&#39;, &#39;saledate&#39;,
        &#39;fiModelDesc&#39;, &#39;fiBaseModel&#39;, &#39;fiSecondaryDesc&#39;, &#39;fiModelSeries&#39;,
        &#39;fiModelDescriptor&#39;, &#39;ProductSize&#39;, &#39;fiProductClassDesc&#39;, &#39;state&#39;,
        &#39;ProductGroup&#39;, &#39;ProductGroupDesc&#39;, &#39;Drive_System&#39;, &#39;Enclosure&#39;,
        &#39;Forks&#39;, &#39;Pad_Type&#39;, &#39;Ride_Control&#39;, &#39;Stick&#39;, &#39;Transmission&#39;,
        &#39;Turbocharged&#39;, &#39;Blade_Extension&#39;, &#39;Blade_Width&#39;, &#39;Enclosure_Type&#39;,
        &#39;Engine_Horsepower&#39;, &#39;Hydraulics&#39;, &#39;Pushblock&#39;, &#39;Ripper&#39;, &#39;Scarifier&#39;,
        &#39;Tip_Control&#39;, &#39;Tire_Size&#39;, &#39;Coupler&#39;, &#39;Coupler_System&#39;,
        &#39;Grouser_Tracks&#39;, &#39;Hydraulics_Flow&#39;, &#39;Track_Type&#39;,
        &#39;Undercarriage_Pad_Width&#39;, &#39;Stick_Length&#39;, &#39;Thumb&#39;, &#39;Pattern_Changer&#39;,
        &#39;Grouser_Type&#39;, &#39;Backhoe_Mounting&#39;, &#39;Blade_Type&#39;, &#39;Travel_Controls&#39;,
        &#39;Differential_Type&#39;, &#39;Steering_Controls&#39;],
       dtype=&#39;object&#39;), False)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, we've finally covered tabular data training with decision trees, random forests, neural networks, and random forests with embeddings. We've ensembled the results of the last 2 to get a score that ("technically") beats the top leaderboard score of the Kaggle competition.</p>
<p>Next, we'll be moving onto natural language models. But, I might also try experimenting with another tabular data set.</p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/DunGeon/tabular/2022/03/31/Blue-Book-NN.html" hidden></a>

  <script src="https://utteranc.es/client.js"
    repo="geon-youn/DunGeon"
    issue-term="pathname"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/DunGeon/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/DunGeon/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/DunGeon/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>The DunGeon holding ipynbs</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/geon-youn" target="_blank" title="geon-youn"><svg class="svg-icon grey"><use xlink:href="/DunGeon/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/griolu" target="_blank" title="griolu"><svg class="svg-icon grey"><use xlink:href="/DunGeon/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
